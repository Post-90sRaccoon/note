### 物理层

* 设备之间的物理连接，可以是有线也可以是无线

* 物理层解决信号调制与解调  数字信号和模拟信号之间的转换及传输
* 把上层数组转换为01的模拟信号传输到电缆上 从电缆收到的数据转换为01
* 物理层要考虑时钟的信号同步

### 链路层

* 链路层负责直接连接的设备间的通信 只关心直接连接的机器间以字节为单位的通信
* 广播域（多台直接连接在一起的设备构成广播域） 比如通过交换机
* 载波侦听多路访问 
* 交换机  记录每个口对应机器的地址 从数据包识别到地址 不会被交换机发送给其他设备 只有通信双方线路被占用 2层设备 交换机接口没有mac地址 
* 网管交换机 验证发件人 3层设备 拔网线前 一个设备 不能声称自己是另一个ip
* media access control 
* wifi 也是载波侦听多路访问 人越多 速度越慢



> `10.3.3.3`    -> 0A030303  -> 00001010 00000011 00000011 00000011-> 100860675

```javascript
function ip2int(ip) {
  return parseInt(ip.split('.').map(it => parseInt(it)).map(it => it.toString(2).padStart(8, '0')).join(''), 2)
}

//左移24位 左移16位 8位 或运算
function ip2int(ip) {
  let parts = ip.split('.').map(Number)
  let result = 0
  for (let i = 0; i < parts.length; i++) {
    result = result | (parts[i] << (3 - i) * 8)
  }
  return result >>> 0
  // 返回正数
}
```

* 局域网之间通信使用mac地址 而不是ip地址
* 通过ip地址   广播谁有这个ip地址 arp协议 address resolution protocol
* arp -a 发送地址不确定是谁 全1 都发一遍
* 可以用ping命令测试

### 网络层

* 网络层负责把ip数据包从起始机器发送到目标机器
* 32位子网掩码 左面全1 右面是0  全1的位对应的ip地址是网络号   剩下部分主机号
* 网络号相同 认为在一个子网里 直接构造以太网包发送 不经过设备中转
* 不在一个子网 就把数据发给网关 网关就是路由  查看路由表 把ip数据包在以太网包里   发给下一个网关
* ip数据包 最大1500字节 头部20字节 mtu  标志:ip分片 判断是否是一组 片偏移 0 1480 2960
* 生存时间ttl 8bit  表示数据包最大被转发多少次  网络里可能有环 包被扔掉会给发送方也回一个消息ICMP 可以探测转发过程中经过哪些设备 发送ttl为1 2 3 4 5 6 7的包  tracert www.baidu.com
* 主机号全0 代表网络号码本身 全1是广播地址
* ping命令探测在网络层能否到达这个目的机器的 目的机器发的回复也能收到
* ping发送的数据包 ICMP协议
* 注册域名 goDaddy
* 169 开头没联网地址  127开头本机地址  224-239 组播地址 
* ip A记录 直接指向一个ip  cname 指向一个域名 随着域名的指向变化  mx foo@qq.com 和xxx/qq.com 解析出不同域名
* nslookup 查询域名记录 

#### DHCP

* dynamic host config protocal
* dhcp server 软件 
* 新机器进来要ip 广播  收到server 可能是多个发送的信息 再广播选择哪个ip 然后server回复 ip mask 网关 dns
* IP地址有租期 快到期续约

#### DNS

* 智能dns 根据请求者地址 返回最近的服务器地址 
* ddns 发现自己ip改变 就改
* hosts文件 有域名和ip的对应关系 首先到这里找 开发阶段可以用 127.0.0.1 static.alicdn.com

#### VPN

* virtual private network   可以想成一条虚拟网线通过vpn服务器直接连接
* 一般vpn连接掉脑会多一个ip地址

#### IPV6

* 16字节  128位

#### 瘦腰模型 ip层

 

### 传输层

* 端口

#### UDP

* 源端口 目的端口  1500-20-8 =1742字节
* 非连接型 直接发过去 不知道送到没有 由接收方验证数据正确
* 67端口 dhcp服务器  53端口 dns
* 0.0.0.0 绑定所有网卡
* 支持广播和组播 255 255 255 255 全一给局域网所有机器发消息 还有所在网段的广播域 网络号不变 主机号全1
* 组播 加入频道 发往频道的全部接收
* dhcp 和 dns 基于udp

#### tcp协议模型介绍

* 大文件 保证送达 有序
* 端口不对等 
*  模型 server 在一个端口监听 任何一个客户端都可以像这个端口发送连接请求 称为握手。 握手成功，建立一个connection 双边都有连接对象 。一个端口可以同时和多个客户端建立连接，通过ip和客户端端口分类收到的消息。连接是双工的。
* 三次握手。client发送给server一个SYN，如果可以server回一个ACK+SYN,客户端回一个ACK  
* 第一次 server直到自己可以收  第二次 client知道自己可以发收 第三次 server知道自己可以发
* 四次挥手。断开连接。当一方不会给另一方发消息时，发送一个FIN，对方回ACK。也有可能三次，当一方不会给另一方发消息时，FIN 、 FIN+ACK 、ACK

![image-20210123221803761](38%20%E7%BD%91%E7%BB%9C.assets/image-20210123221803761.png)

* 窗口大小 16位  字节为单位  64kB 作为接收方 最多接收多少数据 应用层一定要按顺序拿到 接收不一定有序 所以需要一片空间排好序交给应用层
* ip头部20字节 tcp20头部字节 tcp数据包最大负载1460字节
* 确认机制 收到就发ack回复  确认顺序 32位序号 32位确认序号 字节序号   发送方第一次发 序号为1 发了三个字节 回复确认序号为4 表示要第四个字节开始的数据 前三个已经收到
* 握手时位序号为0 是一个随机的相对值 收到ack 为序号为1 相对值加1

 